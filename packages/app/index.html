<html>
<head>
    <title>åšå®¢ç½‘ç«™</title>
    <script src="https://unpkg.com/history@5.0.0"></script>
    <script src="http://localhost:3001/pages.js" async></script>
    <script src="http://localhost:3002/pages.js" async></script>
    <script src="http://localhost:3003/pages.js" async></script>
    <link href="/index.css" rel="stylesheet"/>
</head>
<body>

<div id="app-shell">
    <div id="app-content"><span>å†…å®¹è¿˜åœ¨åŠ è½½ä¸­loadingğŸ˜˜</span></div>
</div>

<script type="module">
    console.log("app-shellåˆå§‹åŒ–äº†");
    window.appHistory = HistoryLibrary.createBrowserHistory();

    const appContent = document.querySelector("#app-content");

    const routes = {
        "/article/": "article-page",
        "/recommendation": "recommendation-article-page",
        "/": "article-list-page",
    };

    const findComponentByPath = (pathname) => {
        const prefix = Object.keys(routes).find(key =>
            pathname.startsWith(key)
        );
        return routes[prefix];
    }

    const updateContent = ({location}) => {
        const next = findComponentByPath(location.pathname);
        const current = appContent.firstChild;
        if (current.nodeName.toLowerCase() !== next) {
            console.log("app-shellå†…éƒ¨ä½¿ç”¨çš„å¾®å‰ç«¯é¡µé¢å˜äº†");
            console.log("é¡¶å±‚è·¯ç”±æ”¹å˜");
            const newComponent = document.createElement(next);
            appContent.replaceChild(newComponent, current);
        } else {
            console.log("app-shellå†…éƒ¨ä½¿ç”¨çš„å¾®å‰ç«¯é¡µé¢ä¸å˜");
        }
    }

    window.appHistory.listen(updateContent);

    updateContent({location: window.location});

    document.addEventListener("click", e => {
        console.log("app-shellæ‹¦æˆªåˆ°è¶…é“¾æ¥çš„ç‚¹å‡»äº‹ä»¶");
        if (e.target.nodeName === "A") {
            const href = e.target.getAttribute("href");
            window.appHistory.push(href);
            e.preventDefault();
        }
    });
</script>

<footer>
    <span>é¡µé¢åˆ‡æ¢æ—¶éšæœºç”Ÿæˆä¸€äº›å†…å®¹</span>
</footer>

<script type="module">
    const randomString = Math.round(Math.random() * 2e5).toString(16);
    document.querySelector("footer span").innerHTML = randomString;
</script>

</body>
</html>
